const debug = require('debug')
const bel = require('bel')
const B = require('B')

module.exports = A

function A(protocol) {
    const log = debug('A')
    const sendParent = protocol(  receive )
    var send2B
    const protocolB = send => {
        send2B = send
        return receive
    }
    const b = B(protocolB)
    send2B('hello B')
    const btn = bel`<button onclick=${onclick}>A</button>`
    const el = bel`<div>
    ${btn}
    ${b}
    </div>`

    return el

    function onclick(event) {
        sendParent({from: 'A', type: 'click'})
        send2B({from: 'A', type: 'click'})
    }

    function receive( message ) {
        log('msg from B', message) 
    }

}