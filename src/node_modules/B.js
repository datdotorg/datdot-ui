const debug = require('debug')
const bel = require('bel')
const C = require('C')

module.exports = B

function B(protocol) {
    const log = debug('B')
    const sendParent = protocol( receive ) // send2A
    sendParent('hello A')
    var send2C
    const protocolC = send => { 
        send2C = send
        return receive
    }
    const c = C(protocolC)
    send2C('Hello C')

    const btn = bel`<button onclick=${onclick}>B</button>`
    const el = bel`<div>${btn}${c}</div>`

    return el

    function onclick(event) {
        sendParent({from: 'B', type: 'click'})
        send2C({from: 'B', type: 'click'})
    }

    function receive( message ) {
        const { from, type, body } = message
        if ( from === 'A' ) {
            send2C({from, type})
            log('msg from A', message)
        } 
        if ( from === 'C' ) {
            sendParent({from, type})
            log('msg from C', message) 
        }
    }
}