const debug = require('debug')
const bel = require('bel')
const csjs = require('csjs-inject')

module.exports = datdot_ui_button

function datdot_ui_button (opts) {
  const { name = `<annonymous-${`${Math.random()}`.slice(2)}>`, protocol } = opts
  const log = debug(name)
  var counter = 0


  var text = opts.text || name
  const send = protocol(hear)
  const element = bel`<button class=${css.btn}>${text}</button>`
  element.onclick = onclick


  return element


  function hear (message) {
    const { flow: [from, id], type, body } = message
    log_from2self = log.extend(from)
    log_from2self(id, type, body)
    if (type === 'update') {
      const { key, value } = body
      if (key !== 'text') return
      log('update text:', value)
      element.textContent = text = value
    }
  }


  function onclick (event) {
    const message = { flow: [name, counter++], type: 'click', body: text }
    log('send', message)
    send(message)
  }


}
const css = csjs`
.btn {
  color: green;
  width: 50px;
  height: 50px;
}`
